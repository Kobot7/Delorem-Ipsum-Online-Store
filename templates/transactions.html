{% extends "admin_base.html" %}
{% block title %}Transactions{% endblock %}
{% block style %}
<style>
  table tbody tr:hover {
      background-color: inherit;
  }

  .internal-product-table thead tr th {
    padding-top: 0.5rem;
    padding-bottom: 0.5rem;
  }

  .internal-product-table thead tr {
    background-color: inherit;
  }

</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-md-11 mt-3">
    <h1 class="d-inline">Transactions</h1>
  </div>

  <div class="col-md-11 mt-3">
    <ul class="nav nav-tabs mb-4">
      <li class="nav-item active"><a class="nav-link active" href="#deliveries" data-toggle="tab">Delivery</a></li>
      <li class="nav-item"><a class="nav-link" href="#collections" data-toggle="tab">Collection</a></li>
    </ul>

    <div class="tab-content">
      <div class="tab-pane active in" id="deliveries">
        <h2 class="d-inline mr-3">Not Delivered</h2>
        {% if deliveryNotCompleteList|length==0 %}
          <p>&nbsp;No new orders.</p>
        {% else %}
          <form action="" method="POST" class="d-inline">
            <input type="submit" class="btn mb-3 stopProp" value="Mark as Complete">
            <div id="accordion">
            {% for transaction in deliveryNotCompleteList %}
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <input type="checkbox" value="{{ transaction.get_id() }}" name="dMarkAsComplete" class="check">
                      <a data-toggle="collapse" data-target="#s{{ transaction.get_id() }}" aria-expanded="true" aria-controls="collapseOne">
                        {{ transaction.get_date_of_order() }} - ID {{ transaction.get_id() }}
                    </h5>
                  </div> <!--Card Header-->

                  <div id="s{{ transaction.get_id() }}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>Status</th>
                            <td colspan="5">{% if transaction.get_completion()==True %}Delivered{% else %}Undelivered{% endif %}</td>
                          </tr>

                          <tr>
                            <th>Date of Order</th>
                            <td colspan="5">{{ transaction.get_date_of_order() }}</td>
                          </tr>

                          <tr>
                            <th>Name</th>
                            <td colspan="5">{{ transaction.get_name() }}</td>
                          </tr>

                          <tr>
                            <th>Contact No.</th>
                            <td>{{ transaction.get_phone() }}</td>
                            <th>Email</th>
                            <td>{{ transaction.get_email() }}</td>
                            <td colspan="2"></td>
                          </tr>

                          <tr>
                            <th>Payment Mode</th>
                            <td>{{ transaction.get_payment_mode() }}</td>
                            <td colspan="4"></td>
                          </tr>

                          <tr>
                            <th>Credit Card No.</th>
                            <td>{{ transaction.get_credit_card_number() }}</td>
                            <th>Expiry Date</th>
                            <td>{{ transaction.get_credit_card_expiry() }}</td>
                            <th>CVV</th>
                            <td> {{ transaction.get_credit_card_cvv() }}</td>
                          </tr>

                          <tr>
                            <th>Address</th>
                            <td colspan="5">{{ transaction.get_street_name() }}, #{{ transaction.get_unit_no() }} (S{{ transaction.get_postal_code() }})</td>
                          </tr>

                          <tr>
                            <th>Items</th>
                            <td colspan="5">
                              <table class="internal-product-table">
                                <thead>
                                  <tr>
                                    <th>Product Name (Serial No.)</th>
                                    <th>Quantity</th>
                                  </tr>
                                </thead>
                                {% for item in transaction.get_items() %}
                                <tbody>
                                  <tr>
                                    <td>{{ item.get_product_name() }} ({{ item.get_serial_no() }})</td>
                                    <td>{{ item.get_quantity() }}</td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                              </table>
                            </td>
                          </tr>

                          <tr>
                            <th>Total</th>
                            <td colspan="5">${{ transaction.get_total() }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!--Card Body-->
                  </div> <!--Drop Content-->
                </div> <!--Card-->
            {% endfor %}
            </div> <!--Accordion-->
          </form>
        {% endif %}

        <br><br>
        <h2 class="d-inline mr-3">Delivered</h2>
        {% if deliveryCompleteList|length==0 %}
          <p>&nbsp;No completed delivery orders.</p>
        {% else %}
          <form action="" method="POST" class="d-inline">
            <input type="submit" class="btn mb-3 stopProp" value="Mark as Incomplete">
            <div id="accordion">
            {% for transaction in deliveryCompleteList %}
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <input type="checkbox" value="{{ transaction.get_id() }}" name="dMarkAsIncomplete" class="check">
                      <a data-toggle="collapse" data-target="#s{{ transaction.get_id() }}" aria-expanded="true" aria-controls="collapseOne">
                        {{ transaction.get_date_of_order() }} - ID {{ transaction.get_id() }}
                    </h5>
                  </div> <!--Card Header-->

                  <div id="s{{ transaction.get_id() }}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>Status</th>
                            <td colspan="5">{% if transaction.get_completion()==True %}Delivered{% else %}Undelivered{% endif %}</td>
                          </tr>

                          <tr>
                            <th>Date of Order</th>
                            <td colspan="5">{{ transaction.get_date_of_order() }}</td>
                          </tr>

                          <tr>
                            <th>Name</th>
                            <td colspan="5">{{ transaction.get_name() }}</td>
                          </tr>

                          <tr>
                            <th>Contact No.</th>
                            <td>{{ transaction.get_phone() }}</td>
                            <th>Email</th>
                            <td>{{ transaction.get_email() }}</td>
                            <td colspan="2"></td>
                          </tr>

                          <tr>
                            <th>Payment Mode</th>
                            <td>{{ transaction.get_payment_mode() }}</td>
                            <td colspan="4"></td>
                          </tr>

                          <tr>
                            <th>Credit Card No.</th>
                            <td>{{ transaction.get_credit_card_number() }}</td>
                            <th>Expiry Date</th>
                            <td>{{ transaction.get_credit_card_expiry() }}</td>
                            <th>CVV</th>
                            <td> {{ transaction.get_credit_card_cvv() }}</td>
                          </tr>

                          <tr>
                            <th>Address</th>
                            <td colspan="5">{{ transaction.get_street_name() }}, #{{ transaction.get_unit_no() }} (S{{ transaction.get_postal_code() }})</td>
                          </tr>

                          <tr>
                            <th>Items</th>
                            <td colspan="5">
                              <table class="internal-product-table">
                                <thead>
                                  <tr>
                                    <th>Product Name (Serial No.)</th>
                                    <th>Quantity</th>
                                  </tr>
                                </thead>
                                {% for item in transaction.get_items() %}
                                <tbody>
                                  <tr>
                                    <td>{{ item.get_product_name() }} ({{ item.get_serial_no() }})</td>
                                    <td>{{ item.get_quantity() }}</td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                              </table>
                            </td>
                          </tr>

                          <tr>
                            <th>Total</th>
                            <td colspan="5">${{ transaction.get_total() }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!--Card Body-->
                  </div> <!--Drop Content-->
                </div> <!--Card-->
            {% endfor %}
            </div> <!--Accordion-->
          </form>
        {% endif %}
      </div> <!--Tab Pane - Delivery -->

      <div class="tab-pane fade pb-4" id="collections">
        <h2 class="d-inline mr-3">Not Collected</h2>
        {% if collectionNotCompleteList|length==0 %}
          <p>&nbsp;No new orders.</p>
        {% else %}
          <form action="" method="POST" class="d-inline">
            <input type="submit" class="btn mb-3 stopProp" value="Mark as Complete">
            <div id="accordion">
              {% for transaction in collectionNotCompleteList %}
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <input type="checkbox" value="{{ transaction.get_id() }}" name="cMarkAsComplete" class="check">
                      <a data-toggle="collapse" data-target="#s{{ transaction.get_id() }}" aria-expanded="true" aria-controls="collapseOne">
                        {{ transaction.get_date_of_order() }} - ID {{ transaction.get_id() }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        Collection on {{ transaction.get_date() }} at {{ transaction.get_time() }}
                      </a>
                    </h5>
                  </div>

                  <div id="s{{ transaction.get_id() }}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>Status</th>
                            <td colspan="5">{% if transaction.get_completion()==True %}Collected{% else %}Uncollected{% endif %}</td>
                          </tr>

                          <tr>
                            <th>Date of Order</th>
                            <td colspan="5">{{ transaction.get_date_of_order() }}</td>
                          </tr>

                          <tr>
                            <th>Name</th>
                            <td colspan="5">{{ transaction.get_name() }}</td>
                          </tr>

                          <tr>
                            <th>Contact No.</th>
                            <td>{{ transaction.get_phone() }}</td>
                            <th>Email</th>
                            <td>{{ transaction.get_email() }}</td>
                            <td colspan="2"></td>
                          </tr>

                          <tr>
                            <th>Payment Mode</th>
                            <td>{{ transaction.get_payment_mode() }}</td>
                            <td colspan="4"></td>
                          </tr>

                          <tr>
                            <th>Credit Card No.</th>
                            <td>{{ transaction.get_credit_card_number() }}</td>
                            <th>Expiry Date</th>
                            <td>{{ transaction.get_credit_card_expiry() }}</td>
                            <th>CVV</th>
                            <td> {{ transaction.get_credit_card_cvv() }}</td>
                          </tr>

                          <tr>
                            <th>Collection Date</th>
                            <td>{{ transaction.get_date() }}</td>
                            <th>Time</th>
                            <td>{{ transaction.get_time() }}</td>
                          </tr>

                          <tr>
                            <th>Items</th>
                            <td colspan="5">
                              <table class="internal-product-table">
                                <thead>
                                  <tr>
                                    <th>Product Name (Serial No.)</th>
                                    <th>Quantity</th>
                                  </tr>
                                </thead>
                                {% for item in transaction.get_items() %}
                                <tbody>
                                  <tr>
                                    <td>{{ item.get_product_name() }} ({{ item.get_serial_no() }})</td>
                                    <td>{{ item.get_quantity() }}</td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                              </table>
                            </td>
                          </tr>

                          <tr>
                            <th>Total</th>
                            <td colspan="5">${{ transaction.get_total() }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!--Card Body-->
                  </div> <!--Drop Content-->
                </div> <!--Card-->
              {% endfor %}
            </div> <!--Accordion-->
          </form>
        {% endif %}

        <br><br>
        <h2 class="d-inline mr-3">Collected</h2>
        {% if collectionCompleteList|length==0 %}
          <p>&nbsp;No new orders.</p>
        {% else %}
          <form action="" method="POST" class="d-inline">
            <input type="submit" class="btn mb-3 stopProp" value="Mark as Incomplete">
            <div id="accordion">
              {% for transaction in collectionCompleteList %}
                <div class="card">
                  <div class="card-header" id="headingOne">
                    <h5 class="mb-0">
                      <input type="checkbox" value="{{ transaction.get_id() }}" name="cMarkAsIncomplete" class="check">
                      <a data-toggle="collapse" data-target="#s{{ transaction.get_id() }}" aria-expanded="true" aria-controls="collapseOne">
                        {{ transaction.get_date_of_order() }} - ID {{ transaction.get_id() }}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                        Collection on {{ transaction.get_date() }} at {{ transaction.get_time() }}
                      </a>
                    </h5>
                  </div>

                  <div id="s{{ transaction.get_id() }}" class="collapse" aria-labelledby="headingOne" data-parent="#accordion">
                    <div class="card-body">
                      <table class="table">
                        <tbody>
                          <tr>
                            <th>Status</th>
                            <td colspan="5">{% if transaction.get_completion()==True %}Collected{% else %}Uncollected{% endif %}</td>
                          </tr>

                          <tr>
                            <th>Date of Order</th>
                            <td colspan="5">{{ transaction.get_date_of_order() }}</td>
                          </tr>

                          <tr>
                            <th>Name</th>
                            <td colspan="5">{{ transaction.get_name() }}</td>
                          </tr>

                          <tr>
                            <th>Contact No.</th>
                            <td>{{ transaction.get_phone() }}</td>
                            <th>Email</th>
                            <td>{{ transaction.get_email() }}</td>
                            <td colspan="2"></td>
                          </tr>

                          <tr>
                            <th>Payment Mode</th>
                            <td>{{ transaction.get_payment_mode() }}</td>
                            <td colspan="4"></td>
                          </tr>

                          <tr>
                            <th>Credit Card No.</th>
                            <td>{{ transaction.get_credit_card_number() }}</td>
                            <th>Expiry Date</th>
                            <td>{{ transaction.get_credit_card_expiry() }}</td>
                            <th>CVV</th>
                            <td> {{ transaction.get_credit_card_cvv() }}</td>
                          </tr>

                          <tr>
                            <th>Collection Date</th>
                            <td>{{ transaction.get_date() }}</td>
                            <th>Time</th>
                            <td>{{ transaction.get_time() }}</td>
                          </tr>

                          <tr>
                            <th>Items</th>
                            <td colspan="5">
                              <table class="internal-product-table">
                                <thead>
                                  <tr>
                                    <th>Product Name (Serial No.)</th>
                                    <th>Quantity</th>
                                  </tr>
                                </thead>
                                {% for item in transaction.get_items() %}
                                <tbody>
                                  <tr>
                                    <td>{{ item.get_product_name() }} ({{ item.get_serial_no() }})</td>
                                    <td>{{ item.get_quantity() }}</td>
                                  </tr>
                                </tbody>
                                {% endfor %}
                              </table>
                            </td>
                          </tr>

                          <tr>
                            <th>Total</th>
                            <td colspan="5">${{ transaction.get_total() }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div> <!--Card Body-->
                  </div> <!--Drop Content-->
                </div> <!--Card-->
              {% endfor %}
            </div> <!--Accordion-->
          </form>
        {% endif %}
      <div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  $('.check').click( function(ev){
    ev.stopImmediatePropagation();
    console.log("clicked!");
  });

  $('.stopProp').click( function(ev){
    ev.stopImmediatePropagation();
    console.log("clicked!");
  });
</script>
{% endblock %}
